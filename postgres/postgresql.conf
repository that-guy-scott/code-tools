# PostgreSQL Configuration for MCP Development Environment
# Optimized for AI/ML workloads and development

# Connection Settings
listen_addresses = '*'
port = 5432
max_connections = 100
superuser_reserved_connections = 3

# Memory Settings
shared_buffers = 128MB              # 25% of RAM for small systems
effective_cache_size = 512MB        # Available OS cache estimate
work_mem = 4MB                      # Memory for sort operations
maintenance_work_mem = 64MB         # Memory for maintenance operations
dynamic_shared_memory_type = posix

# Write-Ahead Logging (WAL)
wal_level = replica                 # Enable replication
wal_buffers = 16MB                  # WAL buffer size
max_wal_size = 2GB                  # Maximum WAL size
min_wal_size = 80MB                 # Minimum WAL size
checkpoint_completion_target = 0.7   # Spread checkpoints
checkpoint_timeout = 10min          # Checkpoint frequency

# Query Planner
default_statistics_target = 100     # Statistics target for optimizer
random_page_cost = 1.1              # SSD-optimized random page cost
effective_io_concurrency = 200      # Concurrent I/O operations

# Logging
logging_collector = off             # Disable file logging in container
log_destination = 'stderr'          # Log to container stdout/stderr
log_statement = 'none'              # Log level for statements
log_duration = off                  # Log query durations
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '
log_timezone = 'UTC'

# Locale and Formatting
datestyle = 'iso, mdy'
timezone = 'UTC'
lc_messages = 'en_US.utf8'
lc_monetary = 'en_US.utf8'
lc_numeric = 'en_US.utf8'
lc_time = 'en_US.utf8'
default_text_search_config = 'pg_catalog.english'

# Performance Tuning for AI/ML Workloads
# Enable parallel query execution
max_parallel_workers_per_gather = 2
max_parallel_workers = 8
max_parallel_maintenance_workers = 2

# JSON/JSONB Performance (for MCP data storage)
gin_pending_list_limit = 4MB

# Connection Pooling Support
tcp_keepalives_idle = 600           # Seconds before sending keepalive
tcp_keepalives_interval = 30        # Interval between keepalives
tcp_keepalives_count = 3            # Failed keepalives before disconnect

# Security Settings
ssl = off                           # Disable SSL in development
password_encryption = scram-sha-256 # Strong password encryption

# Extensions (auto-loaded)
shared_preload_libraries = 'pg_stat_statements'

# Development Settings
autovacuum = on                     # Enable automatic vacuum
autovacuum_max_workers = 3          # Vacuum worker processes
autovacuum_naptime = 1min           # Vacuum check frequency

# Statement Statistics (for query optimization)
pg_stat_statements.max = 10000      # Track top 10000 queries
pg_stat_statements.track = all      # Track all statements